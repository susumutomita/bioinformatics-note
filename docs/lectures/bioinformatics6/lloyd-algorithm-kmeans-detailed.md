# k-Meansã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã® Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆè¶…è©³ç´°ç‰ˆï¼‰

## ğŸ¯ ã¾ãšã€ã“ã®è¬›ç¾©ã§ä½•ã‚’å­¦ã¶ã®ã‹

æœ€çµ‚ã‚´ãƒ¼ãƒ«ï¼š**Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä»•çµ„ã¿ã‚’ç†è§£ã—ã€é…µæ¯éºä¼å­ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã§ç”Ÿç‰©å­¦çš„ç™ºè¦‹ã«ã¤ãªã’ã‚‹**

ã§ã‚‚ã€ã¡ã‚‡ã£ã¨å¾…ã£ã¦ãã ã•ã„ã€‚ãã‚‚ãã‚‚ãªãœã€ŒLloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€ã¨ã„ã†åå‰ãªã®ï¼Ÿå®Ÿã¯ã€ã“ã®æ‰‹æ³•ã¯1957å¹´ã«Stuart Lloyd ãŒç™ºæ˜ã—ãŸã€k-means ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿéš›ã«è§£ãæœ€ã‚‚åŸºæœ¬çš„ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãªã‚“ã§ã™ã€‚

## ğŸ¤” ã‚¹ãƒ†ãƒƒãƒ—0ï¼šãªãœ Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒé‡è¦ãªã®ï¼Ÿ

### 0-1. ãã‚‚ãã‚‚ã®å•é¡Œã‚’è€ƒãˆã¦ã¿ã‚ˆã†

å‰å›ã®è¬›ç¾©ã§ã€Œk-means ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã¯ NPå›°é›£ã€ã¨ã„ã†è¡æ’ƒçš„ãªäº‹å®Ÿã‚’å­¦ã³ã¾ã—ãŸã€‚

ã§ã‚‚å¾…ã£ã¦...NPå›°é›£ãªã®ã«ã€ãªãœç§ãŸã¡ã¯ k-means ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã‚’æ—¥å¸¸çš„ã«ä½¿ãˆã¦ã„ã‚‹ã®ï¼Ÿ

**ç­”ãˆï¼šLloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒã‚ã‚‹ã‹ã‚‰ï¼**

NPå›°é›£ã ã‹ã‚‰ã¨ã„ã£ã¦ã€Œè§£ã‘ãªã„ã€ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã€Œæœ€é©è§£ã‚’ä¿è¨¼ã—ã¦åŠ¹ç‡çš„ã«è§£ãã®ãŒå›°é›£ã€ãªã ã‘ã§ã™ã€‚Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã€**å®Ÿç”¨çš„ãªæ™‚é–“ã§ã€ååˆ†è‰¯ã„è§£ã‚’è¦‹ã¤ã‘ã¦ãã‚Œã‚‹**ã®ã§ã™ã€‚

### 0-2. é©šãã®äº‹å®Ÿ

Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ï¼š

- **å¿…ãšåæŸã™ã‚‹**ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—ã—ãªã„ï¼‰
- **æ¯å›ã€è§£ãŒæ”¹å–„ã•ã‚Œã‚‹**ï¼ˆæ‚ªããªã‚‹ã“ã¨ã¯ãªã„ï¼‰
- **å®Ÿè£…ãŒé©šãã»ã©ã‚·ãƒ³ãƒ—ãƒ«**ï¼ˆã‚ãšã‹æ•°è¡Œã®ã‚³ãƒ¼ãƒ‰ï¼‰

ã¾ã‚‹ã§é­”æ³•ã®ã‚ˆã†ãªæ€§è³ªã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã§ã‚‚å®Ÿã¯ã€ã—ã£ã‹ã‚Šã¨ã—ãŸæ•°å­¦çš„æ ¹æ‹ ãŒã‚ã‚‹ã‚“ã§ã™ã€‚

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—1ï¼šLloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åŸºæœ¬ã‚¢ã‚¤ãƒ‡ã‚¢

### 1-1. ã¾ãšã¯å…·ä½“ä¾‹ã§ç†è§£ã—ã‚ˆã†

ç°¡å˜ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½¿ã£ã¦èª¬æ˜ã—ã¾ã™ï¼š

```
ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆï¼š
A(1,2), B(2,3), C(7,8), D(8,9), E(3,1)

ç›®æ¨™ï¼šã“ã‚Œã‚’ k=2 ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«åˆ†ã‘ãŸã„
```

**è³ªå•ï¼šã©ã†ã‚„ã£ã¦åˆ†ã‘ã‚‹ã®ãŒæœ€é©ã§ã—ã‚‡ã†ï¼Ÿ**

äººé–“ã®ç›®ã§è¦‹ã‚‹ã¨ï¼š

- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼1ï¼šA, B, Eï¼ˆå·¦ä¸‹ã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼2ï¼šC, Dï¼ˆå³ä¸Šã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰

ã“ã‚ŒãŒç›´æ„Ÿçš„ã«ã€Œè‰¯ã„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€ã«è¦‹ãˆã¾ã™ã‚ˆã­ï¼Ÿ

### 1-2. ã§ã‚‚ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã¯ã©ã†è€ƒãˆã‚‹ï¼Ÿ

ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã«ã¯ã€Œç›´æ„Ÿã€ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ•°å­¦çš„ã«å³å¯†ãªæ‰‹é †ãŒå¿…è¦ã§ã™ã€‚

**Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åŸºæœ¬æˆ¦ç•¥ï¼š**

1. ã¾ãšã¯é©å½“ã«ä¸­å¿ƒç‚¹ã‚’æ±ºã‚ã‚‹
2. å„ç‚¹ã‚’æœ€ã‚‚è¿‘ã„ä¸­å¿ƒã«å‰²ã‚Šå½“ã¦ã‚‹
3. å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®é‡å¿ƒã‚’æ–°ã—ã„ä¸­å¿ƒã«ã™ã‚‹
4. 2ã¨3ã‚’ç¹°ã‚Šè¿”ã™

ã€Œé©å½“ã«å§‹ã‚ã¦ã€ã ã‚“ã ã‚“æ”¹å–„ã—ã¦ã„ãã€ã¨ã„ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã™ã€‚

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—2ï¼šLloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è©³ç´°æ‰‹é †

### 2-1. ã‚¹ãƒ†ãƒƒãƒ—0ï¼šåˆæœŸä¸­å¿ƒã®é¸æŠ

```python
import numpy as np
import matplotlib.pyplot as plt

# ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ
points = np.array([[1,2], [2,3], [7,8], [8,9], [3,1]])

# k=2 ãªã®ã§ã€2ã¤ã®ä¸­å¿ƒã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
# ä¾‹ï¼šcenter1 = (2,1), center2 = (6,7)
centers = np.array([[2,1], [6,7]])

print("åˆæœŸä¸­å¿ƒ:", centers)
```

**é‡è¦ãªè¦³å¯Ÿï¼š**
åˆæœŸä¸­å¿ƒã¯ã€Œé©å½“ã€ã«é¸ã‚“ã§ã„ã¾ã™ã€‚æœ€çµ‚çµæœã«å½±éŸ¿ã—ã¾ã™ãŒã€ãã‚Œã§ã‚‚è‰¯ã„è§£ãŒå¾—ã‚‰ã‚Œã‚‹ä¸æ€è­°ãŒã‚ã‚Šã¾ã™ã€‚

### 2-2. ã‚¹ãƒ†ãƒƒãƒ—1ï¼šCenters-to-Clustersï¼ˆä¸­å¿ƒã‹ã‚‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¸ï¼‰

å„ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã‚’ã€**æœ€ã‚‚è¿‘ã„ä¸­å¿ƒã«å‰²ã‚Šå½“ã¦**ã—ã¾ã™ï¼š

```python
def assign_to_nearest_center(points, centers):
    clusters = []
    for point in points:
        distances = [np.linalg.norm(point - center) for center in centers]
        nearest_center = np.argmin(distances)
        clusters.append(nearest_center)
    return clusters

# å®Ÿè¡Œ
clusters = assign_to_nearest_center(points, centers)
print("å„ç‚¹ã®æ‰€å±ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼:", clusters)
```

**ãªãœã€Œæœ€ã‚‚è¿‘ã„ä¸­å¿ƒã€ãªã®ã‹ï¼Ÿ**

ã“ã‚Œã¯ k-means ã®ç›®çš„é–¢æ•°ï¼ˆäºŒä¹—èª¤å·®æ­ªã¿ï¼‰ã‚’æœ€å°åŒ–ã™ã‚‹ãŸã‚ã®åˆç†çš„é¸æŠã§ã™ã€‚é ã„ä¸­å¿ƒã«å‰²ã‚Šå½“ã¦ã‚‹ã¨ã€èª¤å·®ãŒå¤§ãããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

### 2-3. ã‚¹ãƒ†ãƒƒãƒ—2ï¼šClusters-to-Centersï¼ˆã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‹ã‚‰ä¸­å¿ƒã¸ï¼‰

å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®**é‡å¿ƒ**ã‚’æ–°ã—ã„ä¸­å¿ƒã«ã—ã¾ã™ï¼š

```python
def update_centers(points, clusters, k):
    new_centers = []
    for i in range(k):
        cluster_points = points[np.array(clusters) == i]
        if len(cluster_points) > 0:
            centroid = np.mean(cluster_points, axis=0)
            new_centers.append(centroid)
        else:
            # ç©ºã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å ´åˆ
            new_centers.append(centers[i])
    return np.array(new_centers)

# å®Ÿè¡Œ
new_centers = update_centers(points, clusters, 2)
print("æ–°ã—ã„ä¸­å¿ƒ:", new_centers)
```

**ãªãœé‡å¿ƒãªã®ï¼Ÿ**

å‰å›å­¦ã‚“ã **é‡å¿ƒå®šç†**ã‹ã‚‰ï¼šã€Œã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®å…¨ç‚¹ã¨ã®äºŒä¹—è·é›¢å’Œã‚’æœ€å°åŒ–ã™ã‚‹ã®ã¯é‡å¿ƒã€

ã“ã‚Œã§èª¤å·®ãŒç¢ºå®Ÿã«æ¸›å°‘ã—ã¾ã™ï¼

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—3ï¼šåå¾©ãƒ—ãƒ­ã‚»ã‚¹ã®å®Ÿè£…

### 3-1. å®Œå…¨ãª Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```python
def lloyd_algorithm(points, k, max_iterations=100):
    """Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å®Œå…¨å®Ÿè£…"""

    # åˆæœŸåŒ–ï¼šãƒ©ãƒ³ãƒ€ãƒ ã«ä¸­å¿ƒã‚’é¸æŠ
    n, d = points.shape
    centers = points[np.random.choice(n, k, replace=False)]

    history = []  # åæŸéç¨‹ã‚’è¨˜éŒ²

    for iteration in range(max_iterations):
        # ã‚¹ãƒ†ãƒƒãƒ—1ï¼šPoints-to-Centers
        clusters = assign_to_nearest_center(points, centers)

        # ã‚¹ãƒ†ãƒƒãƒ—2ï¼šCenters-to-Points
        new_centers = update_centers(points, clusters, k)

        # åæŸåˆ¤å®š
        if np.allclose(centers, new_centers):
            print(f"åæŸã—ã¾ã—ãŸï¼ˆ{iteration}å›ç›®ï¼‰")
            break

        centers = new_centers
        history.append((centers.copy(), clusters.copy()))

    return centers, clusters, history

# å®Ÿè¡Œä¾‹
final_centers, final_clusters, history = lloyd_algorithm(points, 2)
print("æœ€çµ‚çš„ãªä¸­å¿ƒ:", final_centers)
print("æœ€çµ‚çš„ãªã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°:", final_clusters)
```

### 3-2. é©šãã®çµæœ

ãŸã£ãŸæ•°å›ã®åå¾©ã§ã€é©šãã»ã©è‰¯ã„ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼

```
åˆæœŸä¸­å¿ƒ: [[2, 1], [6, 7]]
â†’ åå¾©1å›ç›®: [[2.0, 2.0], [7.5, 8.5]]
â†’ åå¾©2å›ç›®: [[2.0, 2.0], [7.5, 8.5]]  # åæŸï¼
```

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—4ï¼šåæŸæ€§ã®è¨¼æ˜

### 4-1. ãªãœ Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯å¿…ãšåæŸã™ã‚‹ã®ï¼Ÿ

**è¨¼æ˜ã®æ ¸å¿ƒã‚¢ã‚¤ãƒ‡ã‚¢ï¼š**
å„ã‚¹ãƒ†ãƒƒãƒ—ã§ç›®çš„é–¢æ•°ï¼ˆäºŒä¹—èª¤å·®æ­ªã¿ï¼‰ãŒå˜èª¿æ¸›å°‘ã™ã‚‹

```python
def compute_distortion(points, centers, clusters):
    """äºŒä¹—èª¤å·®æ­ªã¿ã‚’è¨ˆç®—"""
    total_error = 0
    for i, point in enumerate(points):
        center = centers[clusters[i]]
        error = np.sum((point - center) ** 2)
        total_error += error
    return total_error
```

**ã‚¹ãƒ†ãƒƒãƒ—1ã§ã®æ”¹å–„ï¼š**

- å„ç‚¹ã‚’æœ€ã‚‚è¿‘ã„ä¸­å¿ƒã«å‰²ã‚Šå½“ã¦ç›´ã™
- â†’ è·é›¢ãŒæ¸›å°‘ï¼ˆç­‰ã—ã„ã‹å°ã•ããªã‚‹ï¼‰
- â†’ äºŒä¹—èª¤å·®æ­ªã¿ãŒæ¸›å°‘

**ã‚¹ãƒ†ãƒƒãƒ—2ã§ã®æ”¹å–„ï¼š**

- é‡å¿ƒå®šç†ã«ã‚ˆã‚Šã€é‡å¿ƒã¯æœ€é©ãªä¸­å¿ƒä½ç½®
- â†’ äºŒä¹—èª¤å·®æ­ªã¿ãŒã•ã‚‰ã«æ¸›å°‘

**çµè«–ï¼š** æ¯å›æ”¹å–„ + ä¸‹ç•Œã‚ã‚Š â†’ å¿…ãšåæŸ

### 4-2. ã§ã‚‚ã€é­”æ³•ã«ã¯ãƒˆãƒªãƒƒã‚¯ãŒã‚ã‚‹

#### é‡è¦ãªæ³¨æ„ï¼šLloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯å±€æ‰€æœ€é©ã«åæŸã™ã‚‹

```python
# å®Ÿé¨“ï¼šç•°ãªã‚‹åˆæœŸå€¤ã§ã®çµæœæ¯”è¼ƒ
def experiment_different_starts():
    results = []
    for seed in range(10):
        np.random.seed(seed)
        centers, clusters, _ = lloyd_algorithm(points, 2)
        distortion = compute_distortion(points, centers, clusters)
        results.append((seed, distortion, centers))

    # çµæœã‚’è¡¨ç¤º
    for seed, dist, centers in sorted(results, key=lambda x: x[1]):
        print(f"åˆæœŸå€¤{seed}: æ­ªã¿={dist:.2f}, ä¸­å¿ƒ={centers}")

experiment_different_starts()
```

**é©šãã®ç™ºè¦‹ï¼š**
åˆæœŸå€¤ã«ã‚ˆã£ã¦ã€ç•°ãªã‚‹å±€æ‰€æœ€é©ã«åæŸã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—5ï¼šå®Ÿéš›ã®ç”Ÿç‰©å­¦ãƒ‡ãƒ¼ã‚¿ã§ã®å¿œç”¨

### 5-1. é…µæ¯ã®ã‚¸ã‚ªã‚­ã‚·ãƒƒã‚¯ã‚·ãƒ•ãƒˆéºä¼å­

å‰å›å­¦ã‚“ã é…µæ¯ã®ã‚¸ã‚ªã‚­ã‚·ãƒƒã‚¯ã‚·ãƒ•ãƒˆã€‚å®Ÿã¯ã€ã™ã¹ã¦ã®éºä¼å­ãŒé–¢ä¸ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

**ãƒ‡ãƒ¼ã‚¿ã®æ•´ç†ï¼š**

- å…¨é…µæ¯éºä¼å­ï¼šç´„6000å€‹
- ã‚¸ã‚ªã‚­ã‚·ãƒƒã‚¯ã‚·ãƒ•ãƒˆã§ç™ºç¾å¤‰åŒ–ï¼šç´„200-300å€‹
- â†’ ã“ã®200å€‹ã‚’ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã—ãŸã„

```python
# æ¨¡æ“¬ãƒ‡ãƒ¼ã‚¿ï¼šé…µæ¯éºä¼å­ã®ç™ºç¾ãƒ‘ã‚¿ãƒ¼ãƒ³
# 7ã¤ã®æ™‚ç‚¹ã§ã®ç™ºç¾ãƒ¬ãƒ™ãƒ«
gene_expressions = {
    'YAL001C': [0.5, 0.6, 2.1, 3.2, 2.8, 1.2, 0.7],  # ã‚°ãƒ«ã‚³ãƒ¼ã‚¹æ¯æ¸‡ã§ä¸Šæ˜‡
    'YAL002W': [2.1, 1.8, 0.8, 0.3, 0.4, 0.6, 1.9],  # ã‚°ãƒ«ã‚³ãƒ¼ã‚¹æ¯æ¸‡ã§ä¸‹é™
    'YAL003W': [1.0, 0.9, 1.1, 0.8, 1.2, 1.0, 0.9],  # å¤‰åŒ–ãªã—
    # ... (å®Ÿéš›ã¯200å€‹)
}

# k=6 ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
gene_names = list(gene_expressions.keys())
expression_matrix = np.array(list(gene_expressions.values()))

centers, clusters, history = lloyd_algorithm(expression_matrix, 6)
```

### 5-2. ç”Ÿç‰©å­¦çš„ã«æ„å‘³ã®ã‚ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°çµæœ

```python
# å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å¹³å‡ç™ºç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¯è¦–åŒ–
def plot_cluster_patterns(expression_matrix, clusters, k):
    time_points = ['T0', 'T1', 'T2', 'T3', 'T4', 'T5', 'T6']

    plt.figure(figsize=(12, 8))
    for cluster_id in range(k):
        cluster_genes = expression_matrix[np.array(clusters) == cluster_id]
        if len(cluster_genes) > 0:
            avg_pattern = np.mean(cluster_genes, axis=0)
            plt.subplot(2, 3, cluster_id + 1)
            plt.plot(time_points, avg_pattern, 'b-o', linewidth=2)
            plt.title(f'ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ {cluster_id + 1}')
            plt.ylabel('ç›¸å¯¾ç™ºç¾ãƒ¬ãƒ™ãƒ«')
            plt.xticks(rotation=45)

    plt.tight_layout()
    plt.show()

plot_cluster_patterns(expression_matrix, clusters, 6)
```

**é©šãã®ç™ºè¦‹ï¼š**

1. **ä¸Šæ˜‡ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼šã‚°ãƒ«ã‚³ãƒ¼ã‚¹æ¯æ¸‡ã§ç™ºç¾ãŒä¸ŠãŒã‚‹éºä¼å­ç¾¤
   - ç³–æ–°ç”Ÿã€ã‚°ãƒ«ã‚³ãƒ¼ã‚¹åˆæˆé…µç´ ãªã©

2. **ä¸‹é™ãƒ‘ã‚¿ãƒ¼ãƒ³**ï¼šã‚°ãƒ«ã‚³ãƒ¼ã‚¹æ¯æ¸‡ã§ç™ºç¾ãŒä¸‹ãŒã‚‹éºä¼å­ç¾¤
   - è§£ç³–ç³»é…µç´ ã€ã‚°ãƒ«ã‚³ãƒ¼ã‚¹è¼¸é€ä½“ãªã©

3. **ä¸€æ™‚çš„ä¸Šæ˜‡**ï¼šã‚¹ãƒˆãƒ¬ã‚¹å¿œç­”å¾Œã€æ­£å¸¸ã«æˆ»ã‚‹éºä¼å­ç¾¤
   - ã‚¹ãƒˆãƒ¬ã‚¹å¿œç­”ã‚¿ãƒ³ãƒ‘ã‚¯è³ªãªã©

### 5-3. ç”Ÿç‰©å­¦çš„è§£é‡ˆ

ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°çµæœã¯ã€é…µæ¯ã®**ä»£è¬åˆ‡ã‚Šæ›¿ãˆæˆ¦ç•¥**ã‚’æ˜ç¢ºã«ç¤ºã—ã¦ã„ã¾ã™ï¼š

```python
# å„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ç”Ÿç‰©å­¦çš„æ©Ÿèƒ½ã‚’åˆ†æ
cluster_functions = {
    0: "ã‚°ãƒ«ã‚³ãƒ¼ã‚¹è¼¸é€ãƒ»è§£ç³–ç³»ï¼ˆä¸‹é™ï¼‰",
    1: "ç³–æ–°ç”Ÿãƒ»ã‚°ãƒ«ã‚³ãƒ¼ã‚¹åˆæˆï¼ˆä¸Šæ˜‡ï¼‰",
    2: "ã‚¨ã‚¿ãƒãƒ¼ãƒ«ä»£è¬ï¼ˆå¾ŒæœŸä¸Šæ˜‡ï¼‰",
    3: "ã‚¹ãƒˆãƒ¬ã‚¹å¿œç­”ï¼ˆä¸€æ™‚çš„ä¸Šæ˜‡ï¼‰",
    4: "ãƒªãƒœã‚½ãƒ¼ãƒ ç”Ÿåˆæˆï¼ˆä¸‹é™ï¼‰",
    5: "ãƒŸãƒˆã‚³ãƒ³ãƒ‰ãƒªã‚¢å‘¼å¸ï¼ˆä¸Šæ˜‡ï¼‰"
}

for cluster_id, function in cluster_functions.items():
    gene_count = sum(1 for c in clusters if c == cluster_id)
    print(f"ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ {cluster_id}: {function} ({gene_count}å€‹ã®éºä¼å­)")
```

ã¾ã•ã«ã€Œãƒ‡ãƒ¼ã‚¿ã®ä¸­ã«ç”Ÿç‰©å­¦çš„çœŸå®ŸãŒéš ã‚Œã¦ã„ã‚‹ã€ã“ã¨ã‚’ Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒæ˜ã‚‰ã‹ã«ã—ã¦ãã‚Œã¾ã—ãŸï¼

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—6ï¼šLloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®é™ç•Œã¨å¯¾ç­–

### 6-1. å±€æ‰€æœ€é©å•é¡Œã¸ã®å¯¾ç­–

```python
def multiple_runs_lloyd(points, k, num_runs=10):
    """è¤‡æ•°å›å®Ÿè¡Œã—ã¦æœ€è‰¯ã®çµæœã‚’é¸ã¶"""
    best_distortion = float('inf')
    best_result = None

    for run in range(num_runs):
        centers, clusters, history = lloyd_algorithm(points, k)
        distortion = compute_distortion(points, centers, clusters)

        if distortion < best_distortion:
            best_distortion = distortion
            best_result = (centers, clusters, distortion)

        print(f"Run {run}: æ­ªã¿ = {distortion:.2f}")

    return best_result

# å®Ÿè¡Œ
best_centers, best_clusters, best_distortion = multiple_runs_lloyd(points, 2, 10)
print(f"\næœ€è‰¯ã®çµæœ: æ­ªã¿ = {best_distortion:.2f}")
```

### 6-2. åˆæœŸåŒ–ã®æ”¹å–„ï¼šk-means++

```python
def kmeans_plus_plus_init(points, k):
    """k-means++ åˆæœŸåŒ–æ³•"""
    n, d = points.shape
    centers = []

    # æœ€åˆã®ä¸­å¿ƒã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
    centers.append(points[np.random.randint(n)])

    for _ in range(1, k):
        # å„ç‚¹ã‹ã‚‰æœ€ã‚‚è¿‘ã„ä¸­å¿ƒã¾ã§ã®è·é›¢ã‚’è¨ˆç®—
        distances = []
        for point in points:
            min_dist = min([np.linalg.norm(point - center) for center in centers])
            distances.append(min_dist ** 2)

        # è·é›¢ã®äºŒä¹—ã«æ¯”ä¾‹ã™ã‚‹ç¢ºç‡ã§æ¬¡ã®ä¸­å¿ƒã‚’é¸æŠ
        probabilities = np.array(distances) / sum(distances)
        cumulative = np.cumsum(probabilities)
        r = np.random.random()
        next_center_idx = np.searchsorted(cumulative, r)
        centers.append(points[next_center_idx])

    return np.array(centers)

# æ”¹è‰¯ç‰ˆ Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
def improved_lloyd_algorithm(points, k):
    # k-means++ åˆæœŸåŒ–ã‚’ä½¿ç”¨
    centers = kmeans_plus_plus_init(points, k)

    # ä»¥ä¸‹ã¯é€šå¸¸ã® Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨åŒã˜
    # ... (çœç•¥)

    return centers, clusters, history
```

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—7ï¼šæ¬¡ãªã‚‹æŒ‘æˆ¦ - ã‚½ãƒ•ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã¸ã®é“

### 7-1. ãƒãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã®é™ç•Œ

Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ k-means ã¯ã€Œãƒãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€ã§ã™ï¼š

- å„ç‚¹ã¯**1ã¤ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ã®ã¿æ‰€å±**
- å¢ƒç•Œä»˜è¿‘ã®ç‚¹ã‚‚å¼·åˆ¶çš„ã«ã©ã¡ã‚‰ã‹ã«å‰²ã‚Šå½“ã¦

ã§ã‚‚å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã§ã¯ï¼š

```
éºä¼å­Aã®ç™ºç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š[1.2, 1.8, 2.1, 1.9, 1.5, 1.3, 1.0]
éºä¼å­Bã®ç™ºç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š[1.1, 1.9, 2.0, 1.8, 1.4, 1.2, 1.1]
```

ã“ã®2ã¤ã®éºä¼å­ã€ã©ã¡ã‚‰ã‚‚ä¼¼ãŸã‚ˆã†ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ãŒã€ç•°ãªã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«åˆ†é¡ã•ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

### 7-2. ã‚½ãƒ•ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã®ã‚¢ã‚¤ãƒ‡ã‚¢

**æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ï¼š**
å„ç‚¹ãŒå„ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«**æ‰€å±ã™ã‚‹ç¢ºç‡**ã‚’è€ƒãˆã‚‹

```
éºä¼å­A:
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼1ã«70%ã®ç¢ºç‡ã§æ‰€å±
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼2ã«30%ã®ç¢ºç‡ã§æ‰€å±

éºä¼å­B:
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼1ã«40%ã®ç¢ºç‡ã§æ‰€å±
- ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼2ã«60%ã®ç¢ºç‡ã§æ‰€å±
```

ã“ã‚ŒãŒã€Œã‚½ãƒ•ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã€ã®åŸºæœ¬ã‚¢ã‚¤ãƒ‡ã‚¢ã§ã™ï¼

## ğŸ“ ã¾ã¨ã‚ï¼šä»Šæ—¥å­¦ã‚“ã ã“ã¨ã‚’æ•´ç†

### ãƒ¬ãƒ™ãƒ«1ï¼šè¡¨é¢çš„ç†è§£ï¼ˆã“ã‚Œã ã‘ã§ã‚‚OKï¼‰

- Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ k-means ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã®å®Ÿç”¨çš„è§£æ³•
- ã€Œä¸­å¿ƒâ†’ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã€ã€Œã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼â†’ä¸­å¿ƒã€ã‚’äº¤äº’ã«ç¹°ã‚Šè¿”ã™
- å¿…ãšåæŸã™ã‚‹ãŒã€å±€æ‰€æœ€é©ã«é™¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

### ãƒ¬ãƒ™ãƒ«2ï¼šæœ¬è³ªçš„ç†è§£ï¼ˆã“ã“ã¾ã§æ¥ãŸã‚‰ç´ æ™´ã‚‰ã—ã„ï¼‰

- å„ã‚¹ãƒ†ãƒƒãƒ—ã§äºŒä¹—èª¤å·®æ­ªã¿ãŒå˜èª¿æ¸›å°‘ã™ã‚‹ã‹ã‚‰åæŸã™ã‚‹
- é‡å¿ƒå®šç†ã«ã‚ˆã‚Šã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®é‡å¿ƒãŒæœ€é©ãªä¸­å¿ƒä½ç½®
- è¤‡æ•°å›å®Ÿè¡Œã‚„ k-means++ åˆæœŸåŒ–ã§å±€æ‰€æœ€é©å•é¡Œã‚’è»½æ¸›

### ãƒ¬ãƒ™ãƒ«3ï¼šå¿œç”¨çš„ç†è§£ï¼ˆãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ï¼‰

- ç”Ÿç‰©å­¦ãƒ‡ãƒ¼ã‚¿ã§æ„å‘³ã®ã‚ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ãŒå¾—ã‚‰ã‚Œã‚‹
- ã‚½ãƒ•ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã¸ã®è‡ªç„¶ãªæ‹¡å¼µãŒã‚ã‚‹
- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®é™ç•Œã‚’ç†è§£ã—ã€é©åˆ‡ãªå¯¾ç­–ã‚’è¬›ã˜ã‚‰ã‚Œã‚‹

## ğŸ”® æ¬¡å›äºˆå‘Š

æ¬¡å›ã¯ã€Œ**ã‚½ãƒ•ãƒˆã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°ã¨æœŸå¾…å€¤æœ€å¤§åŒ–ï¼ˆEMï¼‰ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **ã€ã‚’å­¦ã³ã¾ã™ã€‚

é…µæ¯éºä¼å­ã®ä¾‹ã§è¦‹ãŸã‚ˆã†ã«ã€ç¾å®Ÿã®ç”Ÿç‰©å­¦çš„ãƒ‡ãƒ¼ã‚¿ã§ã¯ã€Œã¯ã£ãã‚Šã¨ã—ãŸã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¢ƒç•Œã€ãŒå­˜åœ¨ã—ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã§ç™»å ´ã™ã‚‹ã®ãŒã€ç¢ºç‡çš„ãªã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°æ‰‹æ³•ã§ã™ã€‚

æœŸå¾…ã—ã¦ãŠæ¥½ã—ã¿ã«ï¼

---

_ã€Œãƒ‡ãƒ¼ã‚¿ã®ä¸­ã«éš ã•ã‚ŒãŸç”Ÿç‰©å­¦çš„çœŸå®Ÿã‚’ã€æ•°å­¦ã®åŠ›ã§æ˜ã‚‰ã‹ã«ã™ã‚‹ã€_  
_â€” Lloyd ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã€ãã®ç¬¬ä¸€æ­©ã‚’ç¤ºã—ã¦ãã‚Œã¾ã—ãŸ â€”_
