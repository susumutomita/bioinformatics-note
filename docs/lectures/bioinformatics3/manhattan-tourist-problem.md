---
sidebar_position: 4
title: マンハッタン観光問題：配列比較の驚くべき数学的つながり
---

# マンハッタン観光問題：配列比較の驚くべき数学的つながり

## 🎯 まず、この講義で何を学ぶのか

最終ゴール：配列アラインメント問題が、なぜマンハッタンの街を観光する問題と全く同じなのか、その美しい数学的つながりを理解し、動的計画法の威力を体感します。

でも、ちょっと待ってください。そもそも...

## 🤔 ステップ0：なぜマンハッタン？

### 観光と配列比較の不思議な関係

```
生物学者：「2つのDNA配列を比較したい」
数学者：「それ、マンハッタン観光と同じです」
生物学者：「...は？」

実は同じ数学的構造！
```

### 今日の旅程

```
出発：配列比較は難しそう...
↓
経由：マンハッタンを観光しよう！
↓
到着：配列比較が解けた！
```

## 🗽 ステップ1：マンハッタン観光問題

### 1-1. 問題設定

```
あなたはマンハッタンの観光客です

スタート：北西の交差点（青）
ゴール：南東の交差点（赤）

制約：
- 東（→）か南（↓）にしか進めない
- 北や西には戻れない（一方通行）

目標：
できるだけ多くの観光名所を訪れる！
```

### 1-2. 街をグリッドで表現

```
■ = スタート
□ = ゴール
数字 = その道にある観光名所の数

■ →3→ →1→ →0→
↓     ↓     ↓     ↓
1     2     4     1
↓     ↓     ↓     ↓
→0→ →5→ →2→ □
```

### 1-3. 実際に歩いてみよう

```python
# 例1：適当に歩く
経路1 = "→→→↓↓"
訪問数 = 3 + 1 + 0 + 1 + 2 = 7

# 例2：別の道
経路2 = "↓↓→→→"
訪問数 = 1 + 0 + 5 + 2 = 8

どっちがいい？
→ もっといい道があるかも...
```

## 💭 ステップ2：グリーディ戦略を試す

### 2-1. グリーディ戦略とは

```
グリーディ（欲張り）戦略：
「各交差点で、より多くの観光名所がある方を選ぶ」

人間の直感：
「目の前の最善を選び続ければ、
全体でも最善になるはず」
```

### 2-2. グリーディで歩いてみる

```
スタート位置：
選択肢：東(3) vs 南(1)
→ 東を選ぶ（3 > 1）

次の位置：
選択肢：東(1) vs 南(2)
→ 南を選ぶ（2 > 1）

続けると...
合計：23個の観光名所
```

### 2-3. でも、ちょっと待って

```
グリーディの結果：23個

でも別の道だと：25個！

なぜ？
→ 目先の利益にとらわれて
  もっと良い道を見逃した！
```

## 🎨 ステップ3：問題の本質を理解する

### 3-1. 最長経路問題

```
数学的に言うと：
「重み付き有向グラフの最長経路問題」

普通の言葉で：
「数字が書かれた一方通行の道で
 一番高いスコアの道を見つける」
```

### 3-2. なぜ難しいのか

```
n×mのグリッドの場合：

可能な経路数 = C(n+m, n)
            = (n+m)! / (n! × m!)

例：10×10グリッド
→ 184,756通り！

手計算は無理...
```

### 3-3. ブロードウェイの存在

```
現実のマンハッタン：
完全な格子じゃない！

  ■ →→→
  ↓ ↘ ↓  ← ブロードウェイ（斜めの道）
  ↓  ↘↓
  →→→□

より複雑な問題に...
```

## 🔗 ステップ4：配列比較との驚くべきつながり

### 4-1. アラインメントを矢印で表現

```
配列アラインメント：
配列1: A T G - T
配列2: A T C G -

これを矢印で表すと：
A-A: ↘（対角：両方から削除）
T-T: ↘（対角：両方から削除）
G-C: →（水平：配列2から削除）
--G: ↓（垂直：配列1から削除）
T--: →（水平：配列2から削除）
```

### 4-2. 矢印が作る経路

```
アラインメント → グリッド上の経路

■ →→→→
↓↘     ↓
↓  ↘   ↓
↓    ↘ ↓
→→→→□

これ、マンハッタンの道じゃない？
```

### 4-3. 逆も成り立つ

```
グリッド上の経路 → アラインメント

経路：↘↘→↘↓→
これは：
- ↘ = 両方の配列から文字を取る
- → = 配列2からだけ文字を取る
- ↓ = 配列1からだけ文字を取る

アラインメントが構築できる！
```

## 💡 ステップ5：統一的理解

### 5-1. 同じ問題だった

```
配列アラインメント問題
    ‖
マンハッタン観光問題

どちらも：
「グリッド上の最適経路を見つける」
```

### 5-2. スコアの対応

```
配列比較：
- マッチ（対角）= +1点
- ミスマッチ（対角）= 0点
- ギャップ（水平/垂直）= 0点

マンハッタン：
- 対角の道 = マッチなら観光名所あり
- 水平/垂直の道 = 観光名所なし
```

### 5-3. 具体例で確認

```python
# 配列
seq1 = "ATG"
seq2 = "ATC"

# マンハッタングリッド（マッチで+1）
    A   T   C
A   1   0   0
T   0   1   0
G   0   0   0

# 最適経路 = 最適アラインメント！
```

## 🚀 ステップ6：動的計画法への道

### 6-1. 重要な観察

```
ある交差点への最適経路は：
「そこに来る直前の交差点への最適経路」
を使って計算できる！

これが動的計画法の核心
```

### 6-2. 再帰的構造

```python
def 最適スコア(i, j):
    """位置(i,j)への最適スコア"""

    if i == 0 and j == 0:
        return 0  # スタート地点

    # 3つの可能性
    上から = 最適スコア(i-1, j) + 垂直の重み
    左から = 最適スコア(i, j-1) + 水平の重み
    斜めから = 最適スコア(i-1, j-1) + 対角の重み

    return max(上から, 左から, 斜めから)
```

### 6-3. なぜこれが革命的？

```
計算量の劇的な改善：
総当たり：O(2^(n+m)) → 指数的
動的計画法：O(n×m) → 多項式的

10×10グリッド：
184,756通り → 100回の計算で済む！
```

## 🎯 ステップ7：生物学への応用

### 7-1. DNA配列の比較

```python
# ヒトとマウスの遺伝子
human = "ATGCGATCGTAGC"
mouse = "ATGCGAACGTAGC"

# マンハッタン問題として解く
# → 最適アラインメントが見つかる
# → 進化的関係が分かる
```

### 7-2. タンパク質の比較

```
タンパク質配列の場合：
- 20種類のアミノ酸
- 似たアミノ酸は部分点

より複雑なマンハッタン：
- 観光名所に種類がある
- 種類によって点数が違う
```

### 7-3. 医学への貢献

```
配列比較の応用：
1. 病気の原因遺伝子の特定
2. 薬の標的タンパク質の発見
3. ウイルスの変異追跡

すべてマンハッタン観光問題！
```

## 💭 ステップ8：深い洞察

### 8-1. なぜこの対応が成り立つ？

```
本質的に同じ数学的構造：
「順序を保ちながら2つの列を対応付ける」

配列：文字の列
マンハッタン：交差点の列
```

### 8-2. 他の問題との関係

```
同じ構造を持つ問題：
- 編集距離（文字列の差を測る）
- 最長増加部分列
- ナップサック問題（の変種）

すべて動的計画法で解ける！
```

### 8-3. 美しさの理由

```
一見無関係な問題が同じ：
→ 数学の普遍性
→ 抽象化の威力
→ アルゴリズムの再利用可能性
```

## 📝 まとめ：今日学んだこと

### レベル1：基礎理解

```
- マンハッタン観光問題
- グリーディ戦略の限界
- 最長経路問題
```

### レベル2：つながりの理解

```
- アラインメント = グリッド上の経路
- 矢印による対応関係
- スコアの一致
```

### レベル3：深い洞察

```
- 動的計画法の必要性
- 数学的構造の同一性
- 抽象化の威力
```

## 🎯 覚えておくべきこと

```python
def profound_insight():
    """
    配列比較 = マンハッタン観光

    この等式が分かれば：
    - 問題が可視化できる
    - アルゴリズムが理解できる
    - 効率的に解ける
    """

    return "異なる問題の背後にある同じ構造を見抜く"
```

## 🚀 次回予告

次回は「動的計画法の実装」を学びます。マンハッタン観光問題を実際にプログラムで解き、配列アラインメントを高速に計算する方法を習得します！

---

街を歩くことと遺伝子を比較することが、実は同じだなんて！
