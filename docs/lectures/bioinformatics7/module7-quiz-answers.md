# HMM モジュール クイズ解答

## 問題1: コイン投げの確率比較

**問題**: 偏ったコインの表が出る確率が3/4であるカジノで、次のようなコインの裏が出たとします：HTTHH
公平なコインと偏ったコインのどちらがこの順序を生成した可能性が高いか？

**解答**: **フェア（公平なコイン）**

**計算過程**:

```python
# 確率設定
Fair_H = 1/2, Fair_T = 1/2
Biased_H = 3/4, Biased_T = 1/4

# 観測列: HTTHH
# 公平なコインの場合
P(HTTHH | Fair) = (1/2) × (1/2) × (1/2) × (1/2) × (1/2)
                = (1/2)^5
                = 1/32
                ≈ 0.03125

# 偏ったコインの場合
P(HTTHH | Biased) = (3/4) × (1/4) × (1/4) × (3/4) × (3/4)
                   = (3/4)^3 × (1/4)^2
                   = 27/64 × 1/16
                   = 27/1024
                   ≈ 0.0264

# 0.03125 > 0.0264 なので、フェアコインの方が確率が高い
```

## 問題2: HMMの定義要素

**問題**: 隠れマルコフモデルの定義には、次のどのようなものが含まれますか？

**解答**: 以下の4つが含まれます：

- ✅ **隠された状態のセット**
- ✅ **遷移確率の行列**
- ✅ **放出可能な記号のアルファベット**
- ✅ **放出確率の行列**

以下は含まれません：

- ❌ 逆確率（これは計算される値）
- ❌ 順方向確率（これは計算される値）

## 問題3: ビタビグラフの辺の数

**問題**: 2つの記号のアルファベットから長さ4の文字列を発する3つの状態を持つHMMのビタビグラフの辺の数は？

**解答**: **33**

**計算過程**:

```
ビタビグラフの構造：
- ノード: ソース → [3状態] → [3状態] → [3状態] → [3状態] → シンク
- 列数: 6列（ソース + 4時刻 + シンク）

辺の数：
1. ソース → 第1時刻: 3本
2. 第1時刻 → 第2時刻: 3 × 3 = 9本
3. 第2時刻 → 第3時刻: 3 × 3 = 9本
4. 第3時刻 → 第4時刻: 3 × 3 = 9本
5. 第4時刻 → シンク: 3本

合計: 3 + 9 + 9 + 9 + 3 = 33本
```

## 問題4: 条件付き確率の計算

**問題**: π = FBBFF、x = TTHTT が与えられたとき、Pr(x|π)を計算（小数第3位を四捨五入）

**解答**: **0.023**

**計算過程**:

```python
# 状態列: F B B F F
# 観測列: T T H T T
# 各位置での確率:
# 位置1: T from F → P(T|F) = 1/2
# 位置2: T from B → P(T|B) = 1/4
# 位置3: H from B → P(H|B) = 3/4
# 位置4: T from F → P(T|F) = 1/2
# 位置5: T from F → P(T|F) = 1/2

Pr(x|π) = (1/2) × (1/4) × (3/4) × (1/2) × (1/2)
        = 3/128
        = 0.0234375
        ≈ 0.023（小数第3位を四捨五入）
```

## 問題5: プロファイルHMMの放出確率

**問題**: 与えられたアライメントで、8番目のマッチ状態M(8)からセリン(S)が放出される確率は？

**解答**: **0.4**

**計算過程**:

```
アライメント:
M--QKCASHLE-AR
MSNL-C-APD-LER
MSAPNCARKYDI-R
MS-SSCADED-IIR
M--TKC-SKLEIDR

重要な注意:「挿入率>θの列はすでに削除されています」
→ すべての表示されている列がマッチ状態に対応

各位置のマッチ状態:
M1: 位置1 → M,M,M,M,M
M2: 位置2 → -,S,S,S,-
M3: 位置3 → -,N,A,-,-
M4: 位置4 → Q,L,P,S,T
M5: 位置5 → K,-,N,S,K
M6: 位置6 → C,C,C,C,C
M7: 位置7 → A,-,A,A,-
M8: 位置8 → S,A,R,D,S ← これが8番目のマッチ状態
M9: 位置9 → H,P,K,E,K
M10: 位置10 → L,D,Y,D,L
M11: 位置11 → E,-,D,-,E
M12: 位置12 → -,L,I,I,I
M13: 位置13 → A,E,-,I,D
M14: 位置14 → R,R,R,R,R

M8の文字: S, A, R, D, S
Sの出現回数: 2
総数: 5

P(S|M8) = 2/5 = 0.4
```

---

**注意事項**:

- プロファイルHMMでは、挿入状態（ギャップが多数派の列）はマッチ状態としてカウントしません
- 放出確率は観測された文字の頻度から計算されます
- ラプラス平滑化が適用される場合は結果が変わる可能性があります
