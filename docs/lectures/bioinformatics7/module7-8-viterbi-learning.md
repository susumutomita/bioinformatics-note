# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«7-8 ãƒ“ã‚¿ãƒ“å­¦ç¿’ã«ã‚ˆã‚‹HMMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®šï¼ˆè¶…è©³ç´°ç‰ˆï¼‰

## ğŸ¯ ã¾ãšã€ã“ã®è¬›ç¾©ã§ä½•ã‚’å­¦ã¶ã®ã‹

æœ€çµ‚ã‚´ãƒ¼ãƒ«ï¼š**éš ã‚ŒãŸé“ãŒåˆ†ã‹ã‚‰ãªã„çŠ¶æ³ã§ã€HMMã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆé·ç§»ç¢ºç‡ã¨æ”¾å‡ºç¢ºç‡ï¼‰ã‚’è‡ªå‹•çš„ã«å­¦ç¿’ã™ã‚‹æ–¹æ³•ã‚’ãƒã‚¹ã‚¿ã™ã‚‹**

ã§ã‚‚ã€ã¡ã‚‡ã£ã¨å¾…ã£ã¦ãã ã•ã„ã€‚ãã‚‚ãã‚‚ãªãœãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã€Œå­¦ç¿’ã€ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚

å®Ÿã¯ã€ç¾å®Ÿä¸–ç•Œã§ã¯**HMMã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒäº‹å‰ã«åˆ†ã‹ã‚‰ãªã„**ã“ã¨ãŒã»ã¨ã‚“ã©ãªã‚“ã§ã™ã€‚æ¬¡ã®ã‚ˆã†ãªä¾‹ãŒã‚ã‚Šã¾ã™ã€‚

- æ–°ã—ã„ã‚¿ãƒ³ãƒ‘ã‚¯è³ªãƒ•ã‚¡ãƒŸãƒªãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«HMMã‚’ä½œã‚‹ã¨ã
- ã‚«ã‚¸ãƒã®ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ä¸æ­£ã‚’æš´ãã¨ãï¼ˆã‚³ã‚¤ãƒ³ã®åã‚ŠãŒåˆ†ã‹ã‚‰ãªã„ï¼‰
- éºä¼å­ã®æ§‹é€ ã‚’äºˆæ¸¬ã™ã‚‹ã¨ãï¼ˆã©ã“ã§ã©ã†å¤‰åŒ–ã™ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ï¼‰

## ğŸ¤” ã‚¹ãƒ†ãƒƒãƒ—0ï¼šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å­¦ç¿’å•é¡Œã®æœ¬è³ªã‚’ç†è§£ã™ã‚‹

### 0-1. ã‚«ã‚¸ãƒã®ä¾‹ã§è€ƒãˆã¦ã¿ã‚ˆã†

æ¬¡ã®çŠ¶æ³ã‚’æƒ³åƒã—ã¦ãã ã•ã„ã€‚

- ã‚«ã‚¸ãƒã«å…¥ã£ã¦ã€ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ã®ã‚³ã‚¤ãƒ³æŠ•ã’ã‚’è¦³å¯Ÿ
- çµæœã®åˆ—ï¼š`HHTTHHTHHTTTH...`
- ã§ã‚‚ã€ä»Šå›ã¯ä½•ã‚‚åˆ†ã‹ã‚‰ãªã„

**åˆ†ã‹ã‚‰ãªã„ã“ã¨**ï¼š

1. ãƒ•ã‚§ã‚¢ã‚³ã‚¤ãƒ³ã¨ãƒã‚¤ã‚¢ã‚¹ã‚³ã‚¤ãƒ³ã®ãã‚Œãã‚Œã®åã‚Š
2. ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãŒã‚³ã‚¤ãƒ³ã‚’äº¤æ›ã™ã‚‹ç¢ºç‡
3. ã„ã¤ã©ã¡ã‚‰ã®ã‚³ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹

### 0-2. ã“ã‚ŒãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å­¦ç¿’å•é¡Œ

```python
# è¦³å¯Ÿã§ãã‚‹ã‚‚ã®
observations = "HHTTHHTHHTTTH..."  # ã‚³ã‚¤ãƒ³æŠ•ã’ã®çµæœã ã‘

# çŸ¥ã‚ŠãŸã„ã‚‚ã®
unknown_parameters = {
    "fair_coin_heads_prob": "?",      # ãƒ•ã‚§ã‚¢ã‚³ã‚¤ãƒ³ã®è¡¨ã®ç¢ºç‡
    "biased_coin_heads_prob": "?",    # ãƒã‚¤ã‚¢ã‚¹ã‚³ã‚¤ãƒ³ã®è¡¨ã®ç¢ºç‡
    "switch_probability": "?",        # ã‚³ã‚¤ãƒ³äº¤æ›ç¢ºç‡
    "hidden_path": "?"                # ã©ã¡ã‚‰ã®ã‚³ã‚¤ãƒ³ã‚’ã„ã¤ä½¿ã£ãŸã‹
}
```

ã¾ã‚‹ã§**ã€Œé¶ã¨åµã€å•é¡Œ**ã®ã‚ˆã†ã§ã™ã€‚

- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒåˆ†ã‹ã‚Œã° â†’ éš ã‚Œãƒ‘ã‚¹ã‚’æ¨å®šã§ãã‚‹
- éš ã‚Œãƒ‘ã‚¹ãŒåˆ†ã‹ã‚Œã° â†’ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¨å®šã§ãã‚‹

ã§ã‚‚ã€ã©ã¡ã‚‰ã‚‚åˆ†ã‹ã‚‰ãªã„çŠ¶æ³ã§ã™ã€‚ã©ã®ã‚ˆã†ã«è§£æ±ºã™ã‚Œã°ã‚ˆã„ã®ã§ã—ã‚‡ã†ã‹ã€‚

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—1ï¼šã¾ãšç°¡å˜ãªå•é¡Œã‹ã‚‰ - éš ã‚Œãƒ‘ã‚¹ãŒæ—¢çŸ¥ã®å ´åˆ

### 1-1. ã‚‚ã—ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãŒæ­£ç›´ã ã£ãŸã‚‰

é©šãã¹ãã‚·ãƒŠãƒªã‚ªã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãŒ**ã€Œã©ã®ã‚³ã‚¤ãƒ³ã‚’ã„ã¤ä½¿ã£ãŸã‹ã€ã‚’å…¨éƒ¨æ•™ãˆã¦ãã‚ŒãŸ**ã¨ã—ã¾ã™ã€‚

```python
# ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãŒæ•™ãˆã¦ãã‚ŒãŸæƒ…å ±
hidden_path = "FFFFBBBBBFFF..."  # F: ãƒ•ã‚§ã‚¢ã‚³ã‚¤ãƒ³, B: ãƒã‚¤ã‚¢ã‚¹ã‚³ã‚¤ãƒ³
emissions = "HHTTHHTHHTTTH..."

# ã“ã®å ´åˆã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®šã¯ç°¡å˜ã«ãªã‚‹
```

### 1-2. ã‚«ã‚¦ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®æ¨å®š

```python
def estimate_parameters_with_known_path(emissions, hidden_path):
    """
    éš ã‚Œãƒ‘ã‚¹ãŒåˆ†ã‹ã£ã¦ã„ã‚‹ã¨ãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®š
    ã“ã‚Œã¯å˜ç´”ã«ã€Œæ•°ãˆã‚‹ã€ã ã‘ã§æ¸ˆã‚€
    """
    # é·ç§»å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    transitions = {"FF": 0, "FB": 0, "BF": 0, "BB": 0}
    for i in range(len(hidden_path) - 1):
        trans = hidden_path[i] + hidden_path[i+1]
        transitions[trans] += 1

    # æ”¾å‡ºå›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    emissions_count = {
        "F": {"H": 0, "T": 0},
        "B": {"H": 0, "T": 0}
    }
    for i in range(len(hidden_path)):
        state = hidden_path[i]
        symbol = emissions[i]
        emissions_count[state][symbol] += 1

    # ç¢ºç‡ã‚’è¨ˆç®—ï¼ˆé »åº¦ã‹ã‚‰ï¼‰
    print("é·ç§»ç¢ºç‡:")
    print(f"  Fâ†’F: {transitions['FF']} / {transitions['FF'] + transitions['FB']}")
    print(f"  Fâ†’B: {transitions['FB']} / {transitions['FF'] + transitions['FB']}")

    print("æ”¾å‡ºç¢ºç‡:")
    total_F = emissions_count["F"]["H"] + emissions_count["F"]["T"]
    print(f"  F(H): {emissions_count['F']['H']} / {total_F}")
```

**ãƒã‚¤ãƒ³ãƒˆ**ï¼šéš ã‚Œãƒ‘ã‚¹ãŒåˆ†ã‹ã£ã¦ã„ã‚Œã°ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¨å®šã¯**å˜ç´”ãªæ•°ãˆä¸Šã’å•é¡Œ**ã«ãªã‚Šã¾ã™ã€‚

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—2ï¼šæœ¬å½“ã®å•é¡Œ - éš ã‚Œãƒ‘ã‚¹ãŒæœªçŸ¥ã®å ´åˆ

### 2-1. ç¾å®Ÿã®çŠ¶æ³

```python
# ç¾å®Ÿã®å•é¡Œè¨­å®š
observations = "HHTTHHTHHTTTH..."  # ã“ã‚Œã ã‘ãŒä¸ãˆã‚‰ã‚Œã‚‹
hidden_path = "????????????..."    # ã“ã‚Œã¯åˆ†ã‹ã‚‰ãªã„
parameters = {                     # ã“ã‚Œã‚‚åˆ†ã‹ã‚‰ãªã„
    "transition": "?",
    "emission": "?"
}
```

### 2-2. å¤©æ‰çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ï¼šåå¾©çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

ã“ã“ã§**ã€Œé¶ãŒå…ˆã‹åµãŒå…ˆã‹ã€å•é¡Œã‚’è§£ãå¤©æ‰çš„ã‚¢ã‚¤ãƒ‡ã‚¢**ãŒç™»å ´ã—ã¾ã™ï¼š

```mermaid
graph TD
    A[ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§é–‹å§‹] --> B[ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦éš ã‚Œãƒ‘ã‚¹ã‚’æ¨å®š]
    B --> C[éš ã‚Œãƒ‘ã‚¹ã‚’ä½¿ã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å†æ¨å®š]
    C --> D{æ”¹å–„ã—ãŸï¼Ÿ}
    D -->|Yes| B
    D -->|No| E[çµ‚äº†ï¼šæœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç™ºè¦‹]
```

ã“ã‚ŒãŒ**ãƒ“ã‚¿ãƒ“å­¦ç¿’**ã®åŸºæœ¬ã‚¢ã‚¤ãƒ‡ã‚¢ã§ã™ã€‚

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—3ï¼šãƒ“ã‚¿ãƒ“å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®è©³ç´°

### 3-1. ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®å…¨ä½“åƒ

```python
def viterbi_learning(observations, states, max_iterations=100):
    """
    ãƒ“ã‚¿ãƒ“å­¦ç¿’ï¼šè¦³å¯Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰HMMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å­¦ç¿’

    é­”æ³•ã®ã‚ˆã†ãªåå¾©ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼š
    1. é©å½“ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
    2. ãã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒ“ã‚¿ãƒ“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè¡Œï¼ˆéš ã‚Œãƒ‘ã‚¹æ¨å®šï¼‰
    3. ãã®éš ã‚Œãƒ‘ã‚¹ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å†æ¨å®š
    4. åæŸã™ã‚‹ã¾ã§2-3ã‚’ç¹°ã‚Šè¿”ã™
    """

    # ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ©ãƒ³ãƒ€ãƒ åˆæœŸåŒ–
    parameters = initialize_random_parameters(states)

    for iteration in range(max_iterations):
        print(f"\n=== åå¾© {iteration + 1} ===")

        # ã‚¹ãƒ†ãƒƒãƒ—2: ç¾åœ¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§éš ã‚Œãƒ‘ã‚¹ã‚’æ¨å®š
        hidden_path = viterbi_algorithm(observations, parameters)
        print(f"æ¨å®šã•ã‚ŒãŸéš ã‚Œãƒ‘ã‚¹: {hidden_path[:20]}...")

        # ã‚¹ãƒ†ãƒƒãƒ—3: éš ã‚Œãƒ‘ã‚¹ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å†æ¨å®š
        new_parameters = estimate_parameters(observations, hidden_path)

        # ã‚¹ãƒ†ãƒƒãƒ—4: åæŸãƒã‚§ãƒƒã‚¯
        if parameters_converged(parameters, new_parameters):
            print("åæŸã—ã¾ã—ãŸ")
            break

        parameters = new_parameters

    return parameters
```

### 3-2. å…·ä½“ä¾‹ã§å®Ÿé¨“ã—ã¦ã¿ã‚ˆã†

```python
def simple_viterbi_learning_demo():
    """
    ç°¡å˜ãªä¾‹ã§ãƒ“ã‚¿ãƒ“å­¦ç¿’ã‚’ä½“é¨“
    """
    observations = "HHTTHHTHHTTTHHHHTTTHHHT"

    # åå¾©1: ãƒ©ãƒ³ãƒ€ãƒ ãªåˆæœŸå€¤
    params_1 = {
        "transition": {"Fâ†’F": 0.5, "Fâ†’B": 0.5, "Bâ†’F": 0.5, "Bâ†’B": 0.5},
        "emission": {"F(H)": 0.5, "F(T)": 0.5, "B(H)": 0.5, "B(T)": 0.5}
    }

    # ãƒ“ã‚¿ãƒ“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§éš ã‚Œãƒ‘ã‚¹æ¨å®š
    path_1 = "FFFFFFFFFFFBBBBBBBBBBFF"  # ä»®ã®çµæœ

    # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å†æ¨å®š
    # Fâ†’F: 10å›, Fâ†’B: 1å› â†’ P(Fâ†’F) = 10/11 â‰ˆ 0.91
    # Bâ†’B: 10å›, Bâ†’F: 1å› â†’ P(Bâ†’B) = 10/11 â‰ˆ 0.91

    params_2 = {
        "transition": {"Fâ†’F": 0.91, "Fâ†’B": 0.09, "Bâ†’F": 0.09, "Bâ†’B": 0.91},
        "emission": {"F(H)": 0.45, "F(T)": 0.55, "B(H)": 0.7, "B(T)": 0.3}
    }

    print("åå¾©1å¾Œã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ”¹å–„:")
    print("  ã‚³ã‚¤ãƒ³äº¤æ›ç¢ºç‡: 50ï¼… â†’ 9ï¼…ï¼ˆã‚ˆã‚Šå®‰å®šçš„ã«ï¼‰")
    print("  ãƒã‚¤ã‚¢ã‚¹ã‚³ã‚¤ãƒ³ã®åã‚Š: 50ï¼… â†’ 70ï¼…ï¼ˆã‚ˆã‚Šæ˜ç¢ºã«ï¼‰")
```

### 3-3. ãªãœã“ã‚ŒãŒå‹•ä½œã™ã‚‹ã®ã‹

**é©šãã®äº‹å®Ÿ**ï¼šå„åå¾©ã§ã€è¦³å¯Ÿãƒ‡ãƒ¼ã‚¿ã®**å°¤åº¦ï¼ˆã‚‚ã£ã¨ã‚‚ã‚‰ã—ã•ï¼‰ãŒå¿…ãšæ”¹å–„**ã•ã‚Œã¾ã™ã€‚

```python
def why_viterbi_works():
    """
    ãƒ“ã‚¿ãƒ“å­¦ç¿’ãŒå‹•ä½œã™ã‚‹ç†ç”±ã‚’ç†è§£
    """
    # å„åå¾©ã§ã®å°¤åº¦ã®å¤‰åŒ–
    iterations = [1, 2, 3, 4, 5]
    likelihoods = [0.001, 0.01, 0.05, 0.08, 0.09]  # å¿…ãšå¢—åŠ 

    print("å°¤åº¦ã®å¤‰åŒ–:")
    for i, likelihood in zip(iterations, likelihoods):
        print(f"  åå¾©{i}: {'â– ' * int(likelihood * 100)} {likelihood}")

    print("\né‡è¦ãªæ€§è³ª:")
    print("1. å°¤åº¦ã¯å˜èª¿å¢—åŠ ï¼ˆå¿…ãšè‰¯ããªã‚‹ï¼‰")
    print("2. ä¸Šç•ŒãŒã‚ã‚‹ï¼ˆ1ã‚’è¶…ãˆãªã„ï¼‰")
    print("3. ã—ãŸãŒã£ã¦å¿…ãšåæŸã™ã‚‹")
```

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—4ï¼šãƒ“ã‚¿ãƒ“å­¦ç¿’ã®å®Ÿè£…è©³ç´°

### 4-1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åˆæœŸåŒ–

```python
def initialize_parameters_smartly():
    """
    è³¢ã„åˆæœŸåŒ–ã®æ–¹æ³•

    ãƒ©ãƒ³ãƒ€ãƒ ã™ãã‚‹ã¨åæŸãŒé…ã„
    â†’ ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã‚’ä½¿ã£ã¦è³¢ãåˆæœŸåŒ–
    """
    # æ‚ªã„åˆæœŸåŒ–ï¼ˆå®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
    bad_init = {
        "transition": random_matrix(),
        "emission": random_matrix()
    }

    # è‰¯ã„åˆæœŸåŒ–ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã‚’æ´»ç”¨ï¼‰
    good_init = {
        "transition": {
            # çŠ¶æ…‹ã¯æ¯”è¼ƒçš„å®‰å®šã¨ä»®å®š
            "stay": 0.8,
            "switch": 0.2
        },
        "emission": {
            # è¦³å¯Ÿãƒ‡ãƒ¼ã‚¿ã®é »åº¦ã‚’å‚è€ƒã«
            "based_on_observations": count_frequencies(observations)
        }
    }

    return good_init
```

### 4-2. åæŸã®åˆ¤å®š

```python
def check_convergence(old_params, new_params, threshold=1e-6):
    """
    åæŸåˆ¤å®šï¼šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã»ã¨ã‚“ã©å¤‰åŒ–ã—ãªããªã£ãŸã‚‰çµ‚äº†
    """
    max_change = 0

    # ã™ã¹ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰åŒ–é‡ã‚’è¨ˆç®—
    for key in old_params:
        change = abs(old_params[key] - new_params[key])
        max_change = max(max_change, change)

    converged = max_change < threshold

    if converged:
        print(f"âœ“ åæŸã—ã¾ã—ãŸ æœ€å¤§å¤‰åŒ–é‡: {max_change:.8f}")
    else:
        print(f"  ã¾ã åæŸã—ã¦ã„ã¾ã›ã‚“ã€‚å¤‰åŒ–é‡: {max_change:.6f}")

    return converged
```

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—5ï¼šãƒ“ã‚¿ãƒ“å­¦ç¿’ã®é™ç•Œã¨èª²é¡Œ

### 5-1. ãƒãƒ¼ãƒ‰ãªæ±ºå®šã®å•é¡Œ

```python
def viterbi_limitation():
    """
    ãƒ“ã‚¿ãƒ“å­¦ç¿’ã®æ ¹æœ¬çš„ãªé™ç•Œ
    """
    # ãƒ“ã‚¿ãƒ“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¯ã€Œ0ã‹1ã‹ã€ã®æ±ºå®š
    viterbi_decision = {
        "æ™‚åˆ»1": "çŠ¶æ…‹Fï¼ˆ100%ç¢ºä¿¡ï¼‰",
        "æ™‚åˆ»2": "çŠ¶æ…‹Bï¼ˆ100%ç¢ºä¿¡ï¼‰",
        "æ™‚åˆ»3": "çŠ¶æ…‹Fï¼ˆ100%ç¢ºä¿¡ï¼‰"
    }

    # ã§ã‚‚å®Ÿéš›ã¯...
    reality = {
        "æ™‚åˆ»1": "ãŸã¶ã‚“çŠ¶æ…‹Fï¼ˆã§ã‚‚30%ãã‚‰ã„Bã‹ã‚‚ï¼‰",
        "æ™‚åˆ»2": "ãŠãã‚‰ãçŠ¶æ…‹Bï¼ˆã§ã‚‚40%ãã‚‰ã„Fã‹ã‚‚ï¼‰",
        "æ™‚åˆ»3": "å¾®å¦™...ï¼ˆF:51%, B:49%ï¼‰"
    }

    print("å•é¡Œï¼šãƒ“ã‚¿ãƒ“ã¯ç¢ºç‡çš„ãªä¸ç¢ºå®Ÿæ€§ã‚’ç„¡è¦–ã—ã¦ã—ã¾ã†")
```

### 5-2. ãƒ­ãƒ¼ã‚«ãƒ«æœ€é©è§£ã®ç½ 

```python
def local_optimum_problem():
    """
    ãƒ“ã‚¿ãƒ“å­¦ç¿’ã¯ãƒ­ãƒ¼ã‚«ãƒ«æœ€é©è§£ã«é™¥ã‚Šã‚„ã™ã„
    """
    # å±±ç™»ã‚Šæ³•ã®ã‚¢ãƒŠãƒ­ã‚¸ãƒ¼
    print("ãƒ“ã‚¿ãƒ“å­¦ç¿’ã¯å±±ç™»ã‚Šæ³•ã®ã‚ˆã†ãªã‚‚ã®ï¼š")
    print("  1. ä»Šã„ã‚‹å ´æ‰€ã‹ã‚‰ä¸€ç•ªæ€¥ãªæ–¹å‘ã«ç™»ã‚‹")
    print("  2. é ‚ä¸Šã«ç€ã„ãŸã¨æ€ã£ãŸã‚‰æ­¢ã¾ã‚‹")
    print("  3. ã§ã‚‚ãã‚Œã¯ã€Œå±€æ‰€çš„ãªé ‚ä¸Šã€ã‹ã‚‚ã—ã‚Œãªã„")

    # è¤‡æ•°å›ã®å®Ÿè¡Œã§ç•°ãªã‚‹çµæœ
    results = []
    for i in range(5):
        result = viterbi_learning_with_random_init()
        results.append(result)

    print("\n5å›å®Ÿè¡Œã—ãŸçµæœ:")
    for i, r in enumerate(results):
        print(f"  è©¦è¡Œ{i+1}: å°¤åº¦ = {r['likelihood']:.4f}")

    print("\nâ†’ åˆæœŸå€¤ã«ã‚ˆã£ã¦ç•°ãªã‚‹å±€æ‰€æœ€é©è§£ã«åæŸ")
```

## ğŸ“– ã‚¹ãƒ†ãƒƒãƒ—6ï¼šå®Ÿè·µçš„ãªå®Ÿè£…ä¾‹

### 6-1. å®Œå…¨ãªãƒ“ã‚¿ãƒ“å­¦ç¿’ã®å®Ÿè£…

```python
class ViterbiLearning:
    """
    ãƒ“ã‚¿ãƒ“å­¦ç¿’ã®å®Œå…¨å®Ÿè£…
    """

    def __init__(self, states, alphabet):
        self.states = states
        self.alphabet = alphabet
        self.transition = {}
        self.emission = {}

    def learn(self, observations, max_iter=100, convergence_threshold=1e-6):
        """
        ãƒ¡ã‚¤ãƒ³ã®å­¦ç¿’ãƒ«ãƒ¼ãƒ—
        """
        # åˆæœŸåŒ–
        self._initialize_parameters()

        prev_likelihood = float('-inf')

        for iteration in range(max_iter):
            # ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ“ã‚¿ãƒ“ã§éš ã‚Œãƒ‘ã‚¹æ¨å®š
            hidden_path, likelihood = self._viterbi_decoding(observations)

            # ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°
            self._update_parameters(observations, hidden_path)

            # ã‚¹ãƒ†ãƒƒãƒ—3: åæŸãƒã‚§ãƒƒã‚¯
            if abs(likelihood - prev_likelihood) < convergence_threshold:
                print(f"åæŸã—ã¾ã—ãŸï¼ˆåå¾©{iteration}å›ï¼‰")
                break

            prev_likelihood = likelihood

            # é€²æ—è¡¨ç¤º
            if iteration % 10 == 0:
                print(f"åå¾©{iteration}: å°¤åº¦ = {likelihood:.6f}")

        return self.transition, self.emission

    def _initialize_parameters(self):
        """
        ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è³¢ã„åˆæœŸåŒ–
        """
        n_states = len(self.states)
        n_symbols = len(self.alphabet)

        # å¯¾è§’å„ªä½ãªé·ç§»è¡Œåˆ—ï¼ˆçŠ¶æ…‹ãŒå®‰å®šçš„ï¼‰
        for s1 in self.states:
            for s2 in self.states:
                if s1 == s2:
                    self.transition[s1, s2] = 0.8
                else:
                    self.transition[s1, s2] = 0.2 / (n_states - 1)

        # ãƒ©ãƒ³ãƒ€ãƒ ãªæ”¾å‡ºè¡Œåˆ—
        import random
        for state in self.states:
            for symbol in self.alphabet:
                self.emission[state, symbol] = random.random()

            # æ­£è¦åŒ–
            total = sum(self.emission[state, s] for s in self.alphabet)
            for symbol in self.alphabet:
                self.emission[state, symbol] /= total

    def _viterbi_decoding(self, observations):
        """
        ãƒ“ã‚¿ãƒ“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§æœ€é©ãƒ‘ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹
        """
        # ã“ã“ã«æ¨™æº–çš„ãªãƒ“ã‚¿ãƒ“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…
        # ï¼ˆå‰ã®è¬›ç¾©ã§å­¦ã‚“ã å†…å®¹ï¼‰
        pass

    def _update_parameters(self, observations, hidden_path):
        """
        éš ã‚Œãƒ‘ã‚¹ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å†æ¨å®š
        """
        # é·ç§»ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        trans_counts = {}
        for i in range(len(hidden_path) - 1):
            key = (hidden_path[i], hidden_path[i+1])
            trans_counts[key] = trans_counts.get(key, 0) + 1

        # æ”¾å‡ºã‚’ã‚«ã‚¦ãƒ³ãƒˆ
        emit_counts = {}
        for i in range(len(hidden_path)):
            key = (hidden_path[i], observations[i])
            emit_counts[key] = emit_counts.get(key, 0) + 1

        # ç¢ºç‡ã«å¤‰æ›
        self._normalize_parameters(trans_counts, emit_counts)
```

### 6-2. ä½¿ç”¨ä¾‹ï¼šCpGã‚¢ã‚¤ãƒ©ãƒ³ãƒ‰æ¤œå‡ºã¸ã®å¿œç”¨

```python
def cpg_island_viterbi_learning():
    """
    å®Ÿéš›ã®ç”Ÿç‰©å­¦çš„å•é¡Œã¸ã®å¿œç”¨
    CpGã‚¢ã‚¤ãƒ©ãƒ³ãƒ‰ã®æ¤œå‡º
    """
    # DNAã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆCpGã‚¢ã‚¤ãƒ©ãƒ³ãƒ‰ãŒå«ã¾ã‚Œã‚‹ï¼‰
    dna_sequence = "ACGTCGACGTACGTCG" * 100

    # ãƒ“ã‚¿ãƒ“å­¦ç¿’ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¨å®š
    learner = ViterbiLearning(
        states=['CpG', 'Normal'],
        alphabet=['A', 'C', 'G', 'T']
    )

    transition, emission = learner.learn(dna_sequence)

    print("\nå­¦ç¿’ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:")
    print("CpGã‚¢ã‚¤ãƒ©ãƒ³ãƒ‰ã®ç‰¹å¾´:")
    print(f"  CGå‡ºç¾ç‡: {emission['CpG', 'CG']:.3f}")
    print(f"  é€šå¸¸é ˜åŸŸã®CGå‡ºç¾ç‡: {emission['Normal', 'CG']:.3f}")
    print(f"  CpGã‚¢ã‚¤ãƒ©ãƒ³ãƒ‰ã®å¹³å‡é•·: {1/(1-transition['CpG', 'CpG']):.1f}å¡©åŸº")
```

## ğŸ“ ã¾ã¨ã‚ï¼šä»Šæ—¥å­¦ã‚“ã ã“ã¨ã‚’æ•´ç†

### ãƒ¬ãƒ™ãƒ«1ï¼šè¡¨é¢çš„ç†è§£ï¼ˆã“ã‚Œã ã‘ã§ã‚‚OKï¼‰

#### ãƒ“ã‚¿ãƒ“å­¦ç¿’ã¯è¦³å¯Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰HMMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è‡ªå‹•å­¦ç¿’

åŸºæœ¬æ‰‹é †ï¼š

1. é©å½“ã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ±ºã‚ã‚‹
2. ãƒ“ã‚¿ãƒ“ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§éš ã‚Œãƒ‘ã‚¹ã‚’æ¨å®š
3. éš ã‚Œãƒ‘ã‚¹ã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å†è¨ˆç®—
4. åæŸã™ã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™

### ãƒ¬ãƒ™ãƒ«2ï¼šæœ¬è³ªçš„ç†è§£ï¼ˆã“ã“ã¾ã§æ¥ãŸã‚‰ç´ æ™´ã‚‰ã—ã„ï¼‰

#### ã€Œé¶ã¨åµã€å•é¡Œã®è§£æ±ºç­–

- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ â†’ éš ã‚Œãƒ‘ã‚¹ â†’ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ â†’ ... ã®åå¾©
- å„ã‚¹ãƒ†ãƒƒãƒ—ã§å°¤åº¦ãŒå¿…ãšæ”¹å–„ï¼ˆå˜èª¿å¢—åŠ ï¼‰
- ä¸Šç•ŒãŒã‚ã‚‹ã®ã§å¿…ãšåæŸ

**é™ç•Œã®ç†è§£**ï¼š

- ãƒãƒ¼ãƒ‰æ±ºå®šï¼ˆç¢ºç‡çš„ä¸ç¢ºå®Ÿæ€§ã‚’ç„¡è¦–ï¼‰
- ãƒ­ãƒ¼ã‚«ãƒ«æœ€é©è§£ã®å•é¡Œ

### ãƒ¬ãƒ™ãƒ«3ï¼šå¿œç”¨çš„ç†è§£ï¼ˆãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ï¼‰

**å®Ÿè£…ä¸Šã®å·¥å¤«**ï¼š

- è³¢ã„åˆæœŸåŒ–ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã®æ´»ç”¨ï¼‰
- åæŸåˆ¤å®šã®é©åˆ‡ãªè¨­å®š
- è¤‡æ•°å›å®Ÿè¡Œã—ã¦æœ€è‰¯è§£ã‚’é¸æŠ

**ç™ºå±•çš„è©±é¡Œ**ï¼š

- ã‚½ãƒ•ãƒˆãªæ±ºå®šã‚’ä½¿ã†Baum-Welchå­¦ç¿’ã¸ã®é“
- EMã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¨ã®é–¢ä¿‚
- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«HMMæ§‹ç¯‰ã§ã®å®Ÿç”¨

## ğŸš€ æ¬¡å›äºˆå‘Š

ã€Œã‚½ãƒ•ãƒˆãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼šç¢ºç‡çš„ãªä¸ç¢ºå®Ÿæ€§ã‚’æ‰±ã†ã€

æ¬¡å›ã¯ã€ãƒ“ã‚¿ãƒ“å­¦ç¿’ã®é™ç•Œã‚’å…‹æœã™ã‚‹ç”»æœŸçš„ãªæ‰‹æ³•ã‚’å­¦ã³ã¾ã™ã€‚

- Forward-Backwardã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- ã‚½ãƒ•ãƒˆãƒ‡ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆç¢ºç‡çš„ãªçŠ¶æ…‹æ¨å®šï¼‰
- Baum-Welchå­¦ç¿’ï¼ˆEMã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ä¸€ç¨®ï¼‰

ã€Œã“ã®æ™‚åˆ»ã®çŠ¶æ…‹ã¯60ï¼… Fã€40ï¼… Bã€ã®ã‚ˆã†ãª**ç¢ºç‡çš„ãªç­”ãˆ**ã‚’å‡ºã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã•ã‚‰ã«é©šãã¹ãã“ã¨ã«ã€ã“ã®æ‰‹æ³•ã¯**ã‚°ãƒ­ãƒ¼ãƒãƒ«æœ€é©è§£**ã«ã‚ˆã‚Šè¿‘ã¥ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‚“ã§ã™ã€‚ã©ã†ã‚„ã£ã¦ãã‚“ãªã“ã¨ãŒå¯èƒ½ãªã®ã‹ã€æ¬¡å›ãã®ç§˜å¯†ãŒæ˜ã‹ã•ã‚Œã¾ã™ã€‚
